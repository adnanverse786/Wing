# DexOS (Android 11 / API 30) Build Guide for Redmi Note 8 (ginkgo)

This guide explains a realistic, beginner-friendly workflow to build **DexOS** as a lightweight custom ROM using a **LineageOS 18.1 / AOSP Android 11** base for **Xiaomi Redmi Note 8 (ginkgo)**.

---

## 1) Build Environment Setup (Ubuntu/Linux)

## Recommended host OS
- **Ubuntu 20.04 LTS** (most common for Android 11 era trees).
- Ubuntu 22.04 can work, but some legacy build scripts/tools may require small fixes.

## Hardware recommendations
- **CPU:** 8+ threads recommended.
- **RAM:**
  - Minimum: 16 GB (builds may be slow; can fail with OOM if no swap).
  - Recommended: 32 GB.
- **Disk space:**
  - Source tree + out directory + ccache can exceed **250–350 GB**.
  - Keep at least **400 GB free** for comfortable work.
- **Swap:** If RAM is low, configure 16–32 GB swap to reduce out-of-memory failures.

## Required packages and dependencies
```bash
sudo apt update
sudo apt install -y \
  bc bison build-essential ccache curl flex g++-multilib gcc-multilib \
  git git-lfs gnupg gperf imagemagick lib32ncurses5-dev lib32readline-dev \
  lib32z1-dev libelf-dev libgl1-mesa-dev liblz4-tool libsdl1.2-dev \
  libssl-dev libxml2 libxml2-utils lzop openjdk-11-jdk pngcrush \
  python3 python-is-python3 rsync schedtool squashfs-tools xsltproc \
  unzip zip zlib1g-dev adb fastboot
```

## Java version requirements
- Android 11 / LineageOS 18.1 expects **OpenJDK 11**.
- Verify:
```bash
java -version
javac -version
```

## Install `repo` tool
```bash
mkdir -p ~/bin
curl -L https://storage.googleapis.com/git-repo-downloads/repo -o ~/bin/repo
chmod a+rx ~/bin/repo
echo 'export PATH=~/bin:$PATH' >> ~/.bashrc
source ~/.bashrc
repo --version
```

## Optional: enable ccache (recommended)
```bash
echo 'export USE_CCACHE=1' >> ~/.bashrc
echo 'export CCACHE_EXEC=/usr/bin/ccache' >> ~/.bashrc
source ~/.bashrc
ccache -M 100G
```

---

## 2) Source Code Initialization (LineageOS 18.1)

Create workspace:
```bash
mkdir -p ~/android/dexos
cd ~/android/dexos
```

Initialize repo for Android 11 (LineageOS 18.1):
```bash
repo init -u https://github.com/LineageOS/android.git -b lineage-18.1 --git-lfs
```

Sync sources:
```bash
repo sync -c --no-tags --no-clone-bundle --optimized-fetch --prune -j$(nproc --all)
```

### Common sync issues
1. **Network timeouts / RPC failures**
   - Retry with lower parallelism:
   ```bash
   repo sync -j4 --fail-fast
   ```
2. **Disk full**
   - Check with `df -h`; clean `out/` or enlarge disk.
3. **Interrupted sync / corrupted project checkout**
   - Re-sync specific failing project:
   ```bash
   repo sync path/to/failing/project -j1
   ```
4. **Git LFS object issues**
   - Ensure `git-lfs` installed and re-run sync.

---

## 3) Device-Specific Requirements for ginkgo

For a buildable ROM, you need three major device-specific components:

1. **Device tree** (`device/xiaomi/ginkgo`)
   - Defines product config, partitions, init files, overlays, sepolicy rules, feature flags.
   - Includes `AndroidProducts.mk`, `lineage_ginkgo.mk`, `BoardConfig.mk`, `device.mk`, etc.

2. **Kernel source** (`kernel/xiaomi/ginkgo` or shared Xiaomi sm6125 tree depending on maintainer)
   - Builds the Linux kernel + DTBO/DTB artifacts expected by boot image creation.

3. **Vendor blobs** (`vendor/xiaomi/ginkgo`)
   - Proprietary binaries from Xiaomi/MIUI (camera, graphics, radio, sensors, audio HAL pieces, etc.).
   - Required because many hardware interfaces are not fully open source.

### Why ginkgo differs from other devices
- Every device has different SoC integration, partition layout, camera stack, fingerprint implementation, and proprietary HAL dependencies.
- A ROM that boots on one Snapdragon device can still fail on ginkgo without ginkgo-specific trees/blobs.

### Practical acquisition of trees
Use known-maintained trees compatible with LineageOS 18.1. Typical approach:
- Add local manifests under `.repo/local_manifests/` for ginkgo device/kernel/vendor repos.
- Sync again with `repo sync`.

> Important: Pick trees from a trusted maintainer branch specifically targeting Android 11 / lineage-18.1.

---

## 4) Building DexOS

From source root:
```bash
cd ~/android/dexos
source build/envsetup.sh
```

Select target:
```bash
lunch lineage_ginkgo-userdebug
```

Build ROM package:
```bash
mka bacon
```

Alternative:
```bash
brunch ginkgo
```
(Equivalent convenience flow on Lineage-based trees.)

### Expected output files
Usually under:
- `out/target/product/ginkgo/`

Typical artifacts:
- `lineage-18.1-<date>-UNOFFICIAL-ginkgo.zip` (flashable ROM)
- `boot.img`
- `recovery.img` (if generated by tree)
- `vendor_boot.img` (device-dependent)
- `obj/` intermediates

If you rename/rebrand product for DexOS, ZIP name may become `DexOS-...-ginkgo.zip`.

### Source tree vs flashable ZIP
- **Source tree:** human-editable code, build scripts, configuration.
- **Flashable ZIP:** final packaged binary product for recovery sideload/install.

---

## 5) ROM Customization (Lightweight DexOS focus)

## Removing bloatware safely
- Remove non-essential packages from product makefiles (`device.mk`, product `.mk` files).
- Avoid removing core components tied to setup wizard, telephony, media provider, package installer, permissions controller.
- Rebuild and boot-test after each change batch.

## Storage footprint reduction
- Prefer lightweight default apps.
- Avoid shipping duplicate apps with overlapping functionality.
- Keep debug packages and test APKs out of release builds.
- Use `userdebug` while developing; release can move toward `user` when stable.

## Basic performance tuning (safe baseline)
- Keep scheduler/governor defaults unless you can profile changes.
- Reduce background services and non-essential startup receivers.
- Prefer optimization through app/service trimming rather than aggressive kernel undervolt/overclock.

## Thermal safety principles
- Do **not** disable thermal engine or thermal throttling.
- Avoid “performance” tweaks that remove thermal limits.
- Stability + sustained performance is better than short burst benchmark gains.

---

## 6) Boot Animation Integration

`bootanimation.zip` basics:
- Contains `desc.txt` + frame folders (commonly `part0`, `part1`, ...).
- No compression for image frames is common for performance (`zip -0`).

### Typical structure
```text
bootanimation.zip
├── desc.txt
├── part0/
│   ├── 00000.png
│   └── ...
└── part1/
    ├── 00000.png
    └── ...
```

### `desc.txt` format
```text
<width> <height> <fps>
p 1 0 part0
p 0 0 part1
```
- Example for Redmi Note 8 class resolution behavior:
  - Use dimensions that match your designed frames (often 1080x2340 or scaled strategy).
- FPS usually 24–30 for smoothness without heavy decode load.

### Placement inside ROM
Common paths:
- `/system/media/bootanimation.zip`
- or `/product/media/bootanimation.zip` (depends on product config)

In build system, add copy rule in product makefile so it is included in final image.

---

## 7) Common Build Errors and Debugging

## A) Missing vendor blobs
Symptoms:
- `module ... not found`
- proprietary library copy failures
- link errors against vendor HALs

Fix:
- Ensure correct `vendor/xiaomi/ginkgo` tree branch.
- Verify proprietary-files list and blob extraction source compatibility (matching Android base/vendor firmware expectation).

## B) Kernel compile failures
Symptoms:
- `clang`/`ld.lld` errors
- missing defconfig entries
- dtb/dtbo generation errors

Fix:
- Confirm kernel branch matches Android 11 tree.
- Confirm expected toolchain from ROM tree is being used.
- Clean and rebuild kernel objects:
```bash
mka clean
mka bacon
```
(or targeted kernel clean if supported by tree).

## C) Bootloop causes
Frequent reasons:
- Wrong vendor/firmware combination
- Broken sepolicy rules
- Init rc misconfiguration
- Incompatible kernel and vendor modules

Basic debugging workflow:
```bash
adb logcat
adb shell dmesg
adb shell cat /proc/last_kmsg
```
(Last command/path depends on kernel support; `pstore` may be used instead.)

---

## 8) Flashing Requirements and Safety

## Bootloader unlock is mandatory
- Xiaomi devices require unlocked bootloader before custom recovery/ROM flashing.
- Locking bootloader with unofficial ROM can brick/boot-fail.

## Recovery requirements
- Use a recovery build known compatible with ginkgo dynamic/static partition setup for Android 11-era ROMs (e.g., maintained TWRP/OrangeFox variant for ginkgo).
- Ensure recovery can decrypt data if needed.

## Safe flashing sequence (typical clean flash)
1. Backup important data (internal storage may be wiped).
2. Flash/update required firmware if ROM maintainer specifies minimum MIUI firmware.
3. Boot recovery.
4. Wipe `data`, `cache`, `dalvik/art cache` (and system/vendor if required by maintainer instructions).
5. Flash `DexOS-...-ginkgo.zip`.
6. Optionally flash GApps (if ROM is vanilla and you want Google services).
7. Optionally flash Magisk only after first successful boot (recommended for troubleshooting).
8. Reboot and wait patiently for first boot (can take several minutes).

## Safety precautions
- Verify ZIP checksum before flashing.
- Keep battery above ~50%.
- Use original/quality USB cable during sideload operations.
- Keep a known-working recovery image and fastboot ROM path ready for disaster recovery.

---

## 9) Beginner Learning Path (Recommended)

1. First build a **stock LineageOS 18.1 ginkgo** tree successfully.
2. Boot-test it on device.
3. Rebrand to DexOS (name, boot animation, default apps).
4. Apply one optimization category at a time (apps, then services, then UI tweaks).
5. Keep changelog and test matrix (Wi-Fi, RIL, camera, GPS, sensors, encryption, SELinux).
6. Only publish builds that pass daily-driver stability checks.

This process is realistic and avoids “one-click ROM creation” myths.
